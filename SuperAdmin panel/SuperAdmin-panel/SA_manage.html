<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SuperAdmin Manage</title>
  <link rel="stylesheet" href="css/SA_manage.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="../../supabaseClient.js"></script>
</head>
<body>
    <div class="sidebar">
        <div class="user-photo">
            <img src="img/peppa.jpg" alt="User Photo" />
            <div>
                <strong>Juan B. Batumbakal</strong><br/>
                SUPER ADMIN
            </div>
        </div>
        
        <div class="menu">
            <a href="SA_dashboard.html">Dashboard</a>
            <a href="SA_manage.html" class="active">Manage Users</a>
            <div class="reqs-sub-menu">
                <a href="SA_requests.html">Requests</a>
                <div class="sub-menu">
                    <a href="SA_requests.html">Pending</a>
                    <a href="SA_approved.html">Approved</a>
                    <a href="SA_declined.html">Declined</a>
                </div>
            </div>
            <a href="SA_rooms.html">Room Management</a>
            <a href="SA_calendar.html">Calendar</a>
            <a href="SA_reports.html">Reports</a>
        </div>
        
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div class="main">
        <div class="main-container">
            <div class="header-bar">
                <button class="back-btn" onclick="history.back()">‚Üê</button>
                <span>Manage Users</span>
            </div>

            <div class="table-controls">
                <div class="entries-control">
                    <label for="entriesPerPage">Show:</label>
                    <select id="entriesPerPage" onchange="changeEntriesPerPage()">
                        <option value="10">10 entries</option>
                        <option value="20">20 entries</option>
                    </select>
                </div>
                
                <button class="add-admin-btn" onclick="openAddModal()">Add User</button>
            </div>

            <table class="user-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Role</th>
                        <th>Active Status</th>
                        <th>Actions</th>
                    </tr>
                    <tr class="filter-row">
                        <th>
                            <input type="text" id="filterID" placeholder="Filter by ID..." onkeyup="filterByID()" />
                        </th>
                        <th>
                            <input type="text" id="filterName" placeholder="Filter by name/email..." onkeyup="filterByName()" />
                        </th>
                        <th>
                            <select id="filterRole" onchange="filterByRole()">
                                <option value="">All Roles</option>
                                <option value="ADMIN">ADMIN</option>
                                <option value="SUPER ADMIN">SUPER ADMIN</option>
                                <option value="FACULTY">FACULTY</option>
                                <option value="STUDENT ORGANIZATION">STUDENT ORGANIZATION</option>
                            </select>
                        </th>
                        <th>
                            <select id="filterStatus" onchange="filterByStatus()">
                                <option value="">All Status</option>
                                <option value="Online">Online</option>
                                <option value="Offline">Offline</option>
                            </select>
                        </th>
                        <th>
                            <button onclick="clearFilters()" class="clear-filters-btn">Clear All</button>
                        </th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center;">Loading users...</td>
                    </tr>
                </tbody>
            </table>

            <div class="pagination-container">
                <div class="pagination-info">
                    <span id="paginationInfo">Showing 0 to 0 of 0 entries</span>
                </div>
                <div class="pagination-controls">
                    <button id="prevPage" onclick="previousPage()" disabled>‚Üê Previous</button>
                    <div id="pageNumbers" class="page-numbers"></div>
                    <button id="nextPage" onclick="nextPage()" disabled>Next ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">√ó</span>
            <h3 id="modalTitle">Add User</h3>
            <form id="userForm">
                <label for="userFirstName">First Name</label>
                <input type="text" id="userFirstName" required>

                <label for="userLastName">Last Name</label>
                <input type="text" id="userLastName" required>

                <label for="userEmail">Email</label>
                <input type="email" id="userEmail" required>

                <label for="userPassword">New Password</label>
                <div class="password-group">
                    <input type="password" id="userPassword" required>
                    <button type="button" class="toggle-pass" onclick="togglePassword('userPassword')">üëÅÔ∏è</button>
                </div>

                <label for="userRePassword">Re-enter Password</label>
                <div class="password-group">
                    <input type="password" id="userRePassword" required>
                    <button type="button" class="toggle-pass" onclick="togglePassword('userRePassword')">üôà</button>
                </div>

                <label for="userRole">Role</label>
                <select id="userRole" required>
                    <option value="">Select Role</option>
                    <option value="ADMIN">ADMIN</option>
                    <option value="SUPER ADMIN">SUPER ADMIN</option>
                    <option value="FACULTY">FACULTY</option>
                    <option value="STUDENT ORGANIZATION">STUDENT ORGANIZATION</option>
                </select>

                <div class="modal-actions">
                    <button type="submit">Add</button>
                    <button type="button" class="cancel-btn" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Popup -->
    <div id="confirmPopup" class="confirm-popup">
        <div class="popup-content">
            <h3>Confirm Action</h3>
            <p id="confirmMessage">Are you sure you want to delete this user?</p>
            <div class="popup-actions">
                <button id="confirmYes">Yes</button>
                <button class="no-btn" onclick="closeConfirm()">No</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../../supabaseConfig.js"></script>
    <script>
        // Development mode - set to false to use real database
        const USE_MOCK_DATA = false;
        window.USE_MOCK_DATA = USE_MOCK_DATA;
        
        // Override loadCurrentUserInfo to prevent all errors
        window.loadCurrentUserInfo = async function() {
            console.log('‚ÑπÔ∏è loadCurrentUserInfo disabled - account section removed');
            return Promise.resolve();
        };
        
        // Override after all scripts load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                // Force override the function
                if (window.loadCurrentUserInfo) {
                    window.loadCurrentUserInfo = async function() {
                        console.log('‚ÑπÔ∏è Account section removed - function disabled');
                        return Promise.resolve();
                    };
                }
                // Also override global function
                if (typeof loadCurrentUserInfo !== 'undefined') {
                    loadCurrentUserInfo = async function() {
                        console.log('‚ÑπÔ∏è Account section removed - function disabled'); 
                        return Promise.resolve();
                    };
                }
            }, 50);
        });
        
        console.log('üîÑ Page loaded - supabaseConfig.js should handle Supabase initialization');
    </script>
    <script src="java/SA_manage.js"></script>
</body>
</html>